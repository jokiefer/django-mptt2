{% extends "admin/change_list.html" %}
{% load admin_list i18n %}

{% block object-tools-items %}
<li>
    <a href="insert_at/" class="addlink">
        insert node
    </a>
</li>
{{ block.super }}

{% endblock %}

{% block result_list %}
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
<script src=" https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js "></script>


{{ block.super }}
<script>
    var result_list = document.getElementById('result_list').getElementsByTagName('tbody')[0];
    console.log("tbody", result_list);
    var sortable = Sortable.create(result_list, {
        sort: true,
        handle: '.mdi-cursor-move',

        // Changed sorting within list
        onUpdate: function (/**Event*/evt) {
            // same properties as onEnd
            console.log("onUpdate", evt);
            const source_row = document.getElementById('result_list').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[evt.newIndex];
            const target_index = (evt.oldIndex < evt.newIndex) ? evt.newIndex - 1 : evt.newIndex + 1;
            const target_row = document.getElementById('result_list').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[target_index];

            console.log(source_row);
            console.log(target_row);



            const source_move_span = source_row.querySelector(".mdi-cursor-move");
            const target_move_span = target_row.querySelector(".mdi-cursor-move");

            console.log("source pk:", source_move_span.dataset.id);
            console.log("target pk", target_move_span.dataset.id);

            if (target_move_span.dataset.lft < source_move_span.dataset.lft) {

            }

            if (target_move_span.dataset.hasLeafs) {
                console.log("first child of target");
            } else {
                //TODO: get the clostest depth -1
                // target = find_upper(target_move_span.dataset.depth - 1)

            }


        },

    });
    console.log("sortable", sortable);

</script>

{% endblock %}